{% load static %}
<!DOCTYPE html>
<html>
<head>
  <title>Your Shopping Cart</title>
  <meta charset="utf-8">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css"
    integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
  <link rel="stylesheet" type="text/css" href="{% static 'store/css/vendor.css' %}">
  <link rel="stylesheet" type="text/css" href="{% static 'store/css/style.css' %}">
</head>
<body>
  <h1>Your Shopping Cart</h1>

  {% if cart_items %}
    <table>
      <thead>
        <tr>
          <th>Product</th>
          <th>Quantity</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        {% for item in cart_items %}
          <tr>
            <td>{{ item.product.name }}</td>
            <td>
              <input type="number" min="1" value="{{ item.quantity }}" id="quantity-{{ item.product.id }}">
            </td>
            <td>
              <a href="#" data-product-id="{{ item.product.id }}" class="remove-item-link">Remove</a>
              <button data-product-id="{{ item.product.id }}">Update</button>
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>

    <div class="cart-summary">
      <p>Subtotal: $<span id="subtotal">0.00</span></p>
      <p>Tax: $<span id="tax">0.00</span></p>
      <p><strong>Total: $<span id="total">0.00</span></strong></p>
      <button type="button" id="checkout-btn" disabled>Checkout</button>
    </div>
  {% else %}
    <p>Your cart is currently empty.</p>
  {% endif %}

  <script>
    // Replace with your actual logic and calculations
    const cartItems = document.querySelector('tbody');
    const subtotalEl = document.getElementById('subtotal');
    const taxEl = document.getElementById('tax');
    const totalEl = document.getElementById('total');
    const checkoutBtn = document.getElementById('checkout-btn');

    // Function to update cart summary
    function updateCartSummary() {
      let subtotal = 0;
      // Calculate subtotal based on cart items (replace with your logic)
      subtotalEl.textContent = subtotal.toFixed(2);

      // Assuming a fixed 10% tax rate for simplicity
      const tax = subtotal * 0.10;
      taxEl.textContent = tax.toFixed(2);

      const total = subtotal + tax;
      totalEl.textContent = total.toFixed(2);
    }

    // Functionality to remove items
    cartItems.addEventListener('click', (event) => {
      if (event.target.classList.contains('remove-item-link')) {
        const productId = event.target.dataset.productId;

        // Send AJAX request to remove item from cart
        fetch(`/remove-from-cart/${productId}`, {
          method: 'DELETE',
          headers: {
            'Content-Type': 'application/json',
            // Add CSRF token if required by your Django settings
          },
        })
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              // Remove the item row from the table
              event.target.parentElement.parentElement.remove();
              updateCartSummary(); // Recalculate summary
              
              // Check if any items remain and disable checkout button if necessary
              checkoutBtn.disabled = !cartItems.hasChildNodes();
            } else {
              // Handle error (e.g., display an error message)
              console.error('Error removing item from cart:', data.error);
            }
          })
          .catch(error => {
            console.error('Error removing item from cart:', error);
          });
      }
    });

    // Functionality to update cart quantities (replace with AJAX calls to your Django views)
    cartItems
